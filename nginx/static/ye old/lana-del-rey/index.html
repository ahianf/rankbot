<!DOCTYPE html>
<html>
<head>
    <title>Mi Página</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Abril+Fatface&display=swap" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
        body {
            /*background-size: 100% 100%;*/
            font-family: 'Abril Fatface', serif;
            letter-spacing: 0.05rem;
        }

        #vineta {
            background-color: #9a162d;
        }

    </style>

</head>
<body>
<div id="vineta">

    <nav class="navbar">
        <div class="navbar-left">
            <a href="#"></a>
        </div>
        <div class="navbar-right">
            <a href="#">Rankbot.me</a>
        </div>
        <div class="navbar-right">
            <a href="#">Ranking list</a>
        </div>
    </nav>

    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-md-6">
                <div class="img-container">
                    <a href="#"><img src="../images/placeholder.png" alt="Imagen 1" id="image-a"></a>
                    <div class="caption">
                        <h3 id="title-a"></h3>
                        <p id="album-a"></p>
                    </div>
                </div>
            </div>
            <div class="col-xs-12 col-md-6">
                <div class="img-container">
                    <a href="#"><img src="../images/placeholder.png" alt="Imagen 1" id="image-b"></a>
                    <div class="caption">
                        <h3 id="title-b"></h3>
                        <p id="album-b"></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container test">
        <button type="button" class="btn btn-dark btn-spacing" id="draw-button">Draw</button>
        <button type="button" class="btn btn-dark btn-spacing" id="next-button">I don't know</button>
    </div>
</div>
<script>
    // Seleccionar los elementos de la imagen
    const imageA = document.getElementById('image-a');
    const imageB = document.getElementById('image-b');
    const drawButton = document.getElementById('draw-button')
    const nextButton = document.getElementById('next-button')
    let titleA = document.getElementById('title-a');
    let albumA = document.getElementById('album-a');
    let titleB = document.getElementById('title-b');
    let albumB = document.getElementById('album-b');

    let token;

    // Función para obtener las nuevas imágenes del servidor
    function obtenerImagenes() {
        // Enviar solicitud GET para obtener nuevas URL de imágenes y token
        fetch('http://localhost:8080/api/match/lana-del-rey')
            .then(response => response.json())
            .then(data => {
                // Actualizar los elementos de imagen con las nuevas URL de origen y el texto alternativo
                imageA.src = data.songA.artUrl;
                imageA.alt = data.songA.title;
                titleA.innerText = data.songA.title;
                albumA.innerText = data.songA.album;

                imageB.src = data.songB.artUrl;
                imageB.alt = data.songB.title;
                titleB.innerText = data.songB.title;
                albumB.innerText = data.songB.album;

                imageA.classList.remove('animate__zoomOut');
                imageA.classList.add('animate__animated', 'animate__zoomIn');

                imageB.classList.remove('animate__zoomOut');
                imageB.classList.add('animate__animated', 'animate__zoomIn');

                // Almacenar el nuevo token para su uso posterior
                token = data.token;
            })
            .catch(error => {
                console.error('Error updating images:', error);
            });
    }

    // Función para enviar el voto al servidor
    function enviarVoto(vote) {
        // Crear objeto de datos para enviar en petición POST
        const data = {
            token: token,
            vote: vote
        };

        // Enviar solicitud POST a la primera URL
        fetch('http://localhost:8080/api/test', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        })
            .then(() => {
                // Obtener imágenes del servidor
                obtenerImagenes();
            })
            .catch(error => {
                console.error('Error sending vote:', error);
            });
        imageA.classList.add('animate__animated', 'animate__zoomOut');
        imageB.classList.add('animate__animated', 'animate__zoomOut');
    }

    // Añadir escuchadores de eventos click a los elementos de imagen
    imageA.addEventListener('click', () => {
        enviarVoto(1);
    });

    imageB.addEventListener('click', () => {
        enviarVoto(2);
    });

    drawButton.addEventListener('click', () => {
        enviarVoto(3);
    });

    nextButton.addEventListener('click', () => {
        enviarVoto(4);
    });

    // Obtener imágenes iniciales del servidor
    obtenerImagenes();

</script>
</body>
</html>
